name: "Build generic Armbian X86 SDK"
on:
  workflow_dispatch:

jobs:

  build:
    name: "Build generic Armbian X86 SDK"
    runs-on: ubuntu-latest
    steps:

      - name: "Build generic Armbian X86 SDK"
        #uses: armbian/build@AR-1459
        uses: igorpecovnik/build@main
        with:
          armbian_token:       "${{ secrets.GITHUB_TOKEN }}"
          armbian_target:      "image"                            # repace with `kernel` if you only want to build artifacts
          armbian_branch:      "current"                          # branch: legacy, current, edge, etc.
          armbian_release:     "jammy"                            # userspace: jammy, bookworm, trixie, etc.
          armbian_ui:          "minimal"                          # minimal, server, xfce, gnome, etc.
          armbian_compress:    "sha,img,xz"                       # compression method: sha,img,xz
          armbian_version:     "${{ env.ARMBIAN_VERSION }}"       # version override
          armbian_extensions:  "docker-ce"                        # list extensions
          armbian_userpatches: "${{ env.ARMBIAN_USERPATCHES }}"   #
          armbian_board:       "uefi-x86"                         # build target from https://github.com/armbian/build/tree/main/config/boards

      #- name: "Upload to workflow artifacts"
      #  if: ${{ inputs.armbian_upload == 'workflow' }}
      #  uses: actions/upload-artifact@v4
      #  with:
      #    name: armbian-artifacts
      #    path: ${{ env.ARMBIAN_SCRIPT_PATH }}

      - uses: ncipollo/release-action@v1
        #if: ${{ inputs.armbian_upload == 'releases' }}
        with:
          tag: "sdk"
          name: "Armbian SDK"
          artifacts: "${{ env.ARMBIAN_SCRIPT_PATH }}/output/images/*"
          allowUpdates: true
          removeArtifacts: true
          replacesArtifacts: true
          makeLatest: true
          token: "${{ secrets.GITHUB_TOKEN }}"
          body: |
            Unofficial Armbian artifacts with [official tools](https://github.com/armbian/build)
